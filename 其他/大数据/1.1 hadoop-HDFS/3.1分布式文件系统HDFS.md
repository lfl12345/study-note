# 分布式文件系统HDFS

## 概述

### HDFS定义和应用场景

全称：Hadoop Distributed File System ，是一个文件系统，用于存储文件，通过目录树来定位文件；**同时它是分布式的**，由很多服务器联合起来实现其功能，集群中的服务器有各自的角色。

应用场景：**适合一次写入多次读出的场景**。两大核心技术之一，解决海量数据存储问题。

### HDFS的优缺点

#### 优点：

1. 高容错：

   数据自动保存多个副本，它通过增加副本的形式，提高容错性。

   丢失一个副本之后，它可以自动恢复。

2. 适合处理大数据：

   数据规模：能够处理甚至PB级别的数据。

   文件规模：能够处理百万以上的文件数量，数量十分大。

3. 可以构建在廉价的机器上：

   它不是依赖于机器的高可靠性，而是通过多副本机制增加自己的可靠性。

#### 缺点：

1. **不适合低延迟数据访问**，实时性不高，Hbase可以满足实时性

2. **无法高效储存大量小文件：**

   * 存储大量小文件的话，它会占用NameNode 大量的内存来存储文件目录和块信息，这样是不可取的，因为NameNode的内存总是有限的。

   * 小文件的寻址时间会超过读取时间，这样违背了HDFS的设计目标。

3. 不支持并发写入、文件随机修改

   * 一个文件只能由一个写，不能由多个线程同时写。
   * **仅支持数据的append（追加）**，不支持文件的随机修改。

### HDFS组成架构

![image-20211116123938973](C:\Users\lfl\AppData\Roaming\Typora\typora-user-images\image-20211116123938973.png)

* NameNode(nn)：就是Master，他是一个主管、管理者。
  * 管理HDFS的名称空间
  * 配置副本策略
  * 管理数据块（Block）映射信息
  * 处理客户端读写请求
* DataNode(dn)：就是Slave。NameNode下达命令，DataNode执行实际的操作。
  * 存储实际的数据块；
  * 执行数据块的读写操作；
* Client：客户端。
  * 文件切分。文件上传HDFS的时候，Client将文件切分成一个一个的Block，然后进行上传。
  * 与NameNode交互，获取文件的位置信息。
  * 与DataNode交互，读取或者写入数据；
  * Client提供一些命令来管理HDFS，比如NameNode格式化。
  * Client可以通过一些命令来访问HDFS，比如对HDFS增删改查。
* Secondary NameNode：并非NameNode的热备份，当NameNode挂掉的时候，它并不能马上换掉NameNode应提供服务。

### HDFS文件块的大小（重点）

HDFS中的文件在物理上是分块存储（Block），块的大小可以通过配置参数（dfs.blocksize）来规定，默认大小在Hadoop2/3版本中是128M，1版本是64M。

为什么块的大小不能设置太小，也不能设置太大？

* HDFS的块设置太小，会增加寻址时间（NameNode中存储的元数据会增多），程序一直在找块的开始位置；
* 如果快设置太大，从磁盘传输的时间会明显大于定位这个块开始位置所需要的时间，导致程序在处理这块数据时，变得非常满。（换句话说就是不利于一次传输，一次传输的时间会大大加长。）

总结

## NameNode（nn）

存储文件的**元数据**，如**文件名、文件目录结构、文件属性**（生成时间、副本、文件权限），以及每个文件的**块列表**和**块所在的DataNode**等。

## DataNode（dn）

在本地文件系统**存储文件的块数据**，以及**块数据的校验和**。

## Secondary NameNode（2nn）

**每隔一段时间对NameNode元数据备份**

## HDFS读写流程（重点）

### 1、HDFS写流程



## HDFS实现的目标

* 兼容廉价的硬件设备
* 实现流数据读写：不会只读一部分，把海量的数据全部读出来
* 支持大数据集：可以管理很大的文件
* 支持简单的文件模型：只允许追加不允许修改 ，
* 强大的跨平台兼容性：Hadoop基于Java开发的



